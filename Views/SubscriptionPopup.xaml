<?xml version="1.0" encoding="utf-8" ?>
<mopup:PopupPage
    x:Class="Vakilaw.Views.SubscriptionPopup"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:mopup="clr-namespace:Mopups.Pages;assembly=Mopups"
    xmlns:converters="clr-namespace:Vakilaw.Converters"
    xmlns:vm="clr-namespace:Vakilaw.ViewModels"
    BackgroundColor="#80000000" FlowDirection="RightToLeft">

    <mopup:PopupPage.Resources>
        <ResourceDictionary>
            <converters:InverseBoolConverter x:Key="InverseBoolConverter"/>
        </ResourceDictionary>
    </mopup:PopupPage.Resources>

    <mopup:PopupPage.Content>
        <Border
            Padding="20"
            StrokeShape="12"
            BackgroundColor="White"
            HorizontalOptions="Center"
            VerticalOptions="Center"
            WidthRequest="320">

            <VerticalStackLayout Spacing="15">

                <!-- عنوان -->
                <Label Text="اشتراک و لایسنس" FontAttributes="Bold" FontSize="20" HorizontalOptions="Center"/>

                <!-- وضعیت Trial -->
                <StackLayout IsVisible="{Binding IsTrialActive}">
                    <Label Text="Trial فعال است تا:" FontAttributes="Bold"/>
                    <Label Text="{Binding TrialEndDate, StringFormat='{}{0:yyyy/MM/dd}'}"/>
                </StackLayout>

                <!-- نمایش خطا -->
                <Label Text="{Binding ErrorMessage}" 
                       TextColor="Crimson" 
                       IsVisible="{Binding HasError}" 
                       HorizontalOptions="Center"/>

                <Entry Placeholder="کلید لایسنس"
                       Text="{Binding LicenseKey}"
                       IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolConverter}}"/>

                <Picker Title="نوع اشتراک"
                        ItemsSource="{Binding SubscriptionOptions}"
                        SelectedItem="{Binding SelectedSubscription}"
                        IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolConverter}}"/>

                <!-- Activity Indicator -->
                <ActivityIndicator IsRunning="{Binding IsProcessing}" 
                                   IsVisible="{Binding IsProcessing}" 
                                   HorizontalOptions="Center"/>

                <Button Text="{Binding ActivateButtonText}"
                        Command="{Binding ActivateLicenseCommand}"
                        IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolConverter}}"
                        BackgroundColor="#0078D7" TextColor="White" CornerRadius="8"/>

                <Button Text="انصراف"
                        Command="{Binding ClosePopupCommand}"
                        IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBoolConverter}}"
                        BackgroundColor="LightGray" CornerRadius="8"/>

            </VerticalStackLayout>
        </Border>
    </mopup:PopupPage.Content>
</mopup:PopupPage>