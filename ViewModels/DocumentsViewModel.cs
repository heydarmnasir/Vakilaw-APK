using CommunityToolkit.Maui.Alerts;
using CommunityToolkit.Maui.Core;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Vakilaw.Services;

namespace Vakilaw.ViewModels;

public partial class DocumentsViewModel : ObservableObject
{
    #region Contracts
    [ObservableProperty] private bool isContractsVisible;
    [ObservableProperty] private bool isBillsVisible;
    [ObservableProperty] private bool isWelcomeVisible = true;

    [ObservableProperty] private string selectedTab; // "Contract", "Pleading"

    [ObservableProperty] private string contractContent;

    string ConContent = "ماده 1- طرفین قرارداد : پیرو تنظیم وکالت نامه شماره ………. مورخ ……………….. قرارداد حق‌الوکاله به شرح زیر فی مابین خانم/آقای: ……………………….. فرزند ………………… شماره شناسنامه ………….. کدملی ………………… صادره از ……….. شماره تماس ………………. ساکن …………………………………………………………………….\r\nبه عنوان موکل و\r\nآقا/خانم ………………………. فرزند …………………. شماره شناسنامه …………… کدملی ………………… صادره از ……………… شماره تماس ………………… ساکن …………………………………………………………………….\r\nبه عنوان وکیل تنظیم گردیده که برای طرفین لازم‌الاجرا می‌باشد.\r\n \r\nماده 2- موضوع وکالت: موضوع وکالت عبارت است از …………………………………………\r\n \r\nماده 3- مبلغ قرارداد (حق الوکاله): حق الوکاله طبق توافق طرفین مبلغ …………………….. ریال معادل ………………. تومان تعیین گردید.\r\nتبصره: ما بین طرفین مقرر گردید که مبلغ …………………….. ریال معادل ………………… تومان نقداً و مابقی پس از اخذ حکم به نفع موکل دریافت گردد.\r\n \r\nماده 4- شرایط قرارداد: 1-تعهدات وکیل در اجرای این قرارداد، موکول به وصول مبلغ اولیه حق‌الوکاله خواهد بود.\r\n2-وکیل فوق‌الذکر موظف است در راستای احقاق حقوق موکل یا موکلین تمامی تلاش و کوشش خود را مبذول داشته و از هر طریقی که لازم بداند، اقدامات مقتضی را جهت مصلحت موکل به انجام رساند.\r\n3- موکل با اطلاع از اثر عدم پیشرفت کار و عواقب احتمالی آن قرارداد را امضاء نمود؛ بنابراین عدم پیشرفت کار برائت موکل را از پرداخت مبالغ مندرج در ماده 3 قرارداد حاصل نمی‌نماید.\r\n4- در صورت عزل وکیل یا ضم وکیل به وکیل، صلح و سازش طرفین دعوا با مداخله وکیل یا بدون مداخله وکیل، انصراف موکل از تعقیب موضوع در هر مرحله که باشد، استرداد دعوی توسط موکل یا طرف دعوی، وضع مقررات جدید یا به هر علتی که موضوع دعوا فیصله یابد، موکل متعهد است در تمام موارد فوق‌الذکر حق‌الوکاله مندرج در ماده 3 قرارداد را نقداً به صورت یکجا در مقابل اخذ رسید به وکیل پرداخت نماید.\r\n5- چنانچه موضوع وکالت ولو با ارسال اظهارنامه یا مذاکره شفاهی یا مصالحه به نتیحه برسد، موکل ملزم به پرداخت تمام حق الوکاله است.\r\n6-موکل در مورد حق‌الوکاله و کلیه اقدامات وکیل در جریان دادرسی هیچگونه اعتراض و ادعایی اعم از کیفری، حقوقی و انتظامی نداشته و به موجب این مقرره با رضایت کامل، تمامی اختلافات و دعاوی احتمالی آتی را با وکیل انتخابی خویش به صلح خاتمه می‌دهد.\r\n7- چنانچه پس از امضاء قرارداد و قبل از هرگونه اقدامی از جانب وکیل، موکل اقدام به عزل وکیل نماید، در این صورت موکل موظف است نیمی از مبلغ پیش پرداخت را به وکیل بپردازد.\r\n8- تعیین اوقات دادرسی با محکمه بوده و وکیل هیچگونه مسئولیتی در کندی و تسریع دادرسی ندارد.\r\n9- تعهد وکیل در مقابل موکل فقط دفاع از حقوق موکل در حد توانایی علمی و فنی خویش و با توجه به قوانین و مقررات مربوطه است و تصمیم گیرنده در خصوص دعوا قاضی است و وکیل هیچ تسلطی بر وی ندارد.\r\n10- این قرارداد شامل مرحله اجرای حکم نخواهد بود و چنانچه موکل تمایل به پیگیری مرحله اجرائی حکم توسط وکیل داشته باشد، می‌بایستی با توافق طرفین حق‌الوکاله آن مرحله نیز مشخص و نقداً به وکیل نیز پرداخت گردد؛ در غیر این صورت وکیل مزبور هیچ مسئولیتی در پیگیری مراحل اجرائی حکم نخواهد داشت.\r\n11- تهیه وسایل اجرای قرارهای دادگاه، معرفی شهود و مطلعین، احضار و جلب متهم به عهده وکیل نبوده و موکل موظف است نسبت به این امور اقدام کند.\r\n12- پرداخت هزینه‌های دادرسی و سایر هزینه‌ها از قبیل الصاق و ابطال تمبر، دستمزد کارشناس منتخب دادگاه، داور مورد رضایت طرفین، هزینه درج آگهی، هزینه مسافرت و غیره که برای رسیدگی و پیگیری پرونده مطروحه و احقاق حقوق موکل لازم باشد؛ به عهده موکل می‌باشد که در هر مرحله که لازم باشد، موکل موظف است نسبت به پرداخت نقدی هزینه موارد مذکور اقدام نماید؛ در غیر این صورت وکیل هیچ مسئولیتی به عهده نخواهد داشت.\r\n13- پرداخت مالیات و سهم کانون وکلاء به عهده وکیل خواهد بود.\r\n \r\nماده 5- مرجع حل اختلاف: در صورت بروز اختلاف ما بین طرفین به ترتیب از طریق مذاکره بین‌الطرفینی و سپس داوری و در نهایت مرجع صالح قانونی اقدام خواهد شد.\r\n \r\nماده 6- نُسخ قرارداد: این قرارداد مشتمل بر هفت ماده و یک تبصره در تاریخ ……………….. به تعداد …….. نسخه با اعتبار واحد تنظیم، امضاء و بین طرفین جهت اجراء مبادله گردید.\r\n\nامضاء وکیل\t\t\t\t\t\t\t\tامضاء موکل";
    #endregion

    #region Bill
    [ObservableProperty] private List<string> billTitles;
    [ObservableProperty] private string selectedBillTitle;
    [ObservableProperty] private string billContent;

    [ObservableProperty] private string printButtonText = "استخراج فایل PDF";

    partial void OnIsContractsVisibleChanged(bool value)
    {
        if (value)
            PrintButtonText = "🖨️ استخراج فایل PDF قرارداد";
    }

    partial void OnIsBillsVisibleChanged(bool value)
    {
        if (value)
            PrintButtonText = "🖨️ استخراج فایل PDF لایحه";
    }

    #endregion

    private readonly IPrinterService _printerService;

    public DocumentsViewModel(IPrinterService printerService)
    {
        _printerService = printerService;

        BillTitles = new List<string>
        {
             "درخواست مطالعه پرونده",
            "درخواست اجرای حکم",
            "استرداد اعتراض به نظریه کارشناسی",
            "استرداد دادخواست",
              "اسقاط حق تجدیدنظرخواهی یا فرجام‌خواهی",
              "اعتراض به بهای خواسته",
              "اظهار به تقدیم دادخواست جلب ثالث",
              "لایحه دفاعیه (در دعاوی حقوقی)",
              "اعتراض به رأی بدوی",
              "دفاعیه در دعاوی کیفری",
              "درخواست استمهال (تمدید مهلت)",
              "معرفی داور",
              "✍️ لایحه (سفارشی)",
        };
    }

    partial void OnSelectedBillTitleChanged(string value)
    {
        // به محض انتخاب عنوان، متن پیش‌فرض نمایش داده میشه
        switch (value)
        {
            case "درخواست مطالعه پرونده":
                BillContent = "بسمه تعالی\r\nریاست محترم شعبه … دادگاه عمومی/ کیفری / اجرای احکام …\r\nبا سلام و احترام\r\nاینجانب (نام وکیل)، وکیل پایه یک دادگستری به وکالت از (نام موکل)، در پرونده شماره (شماره پرونده) مطروحه در آن مرجع محترم، به استحضار می‌رساند:\r\nنظر به ضرورت بررسی مستندات و مدارک موجود در پرونده و دفاع مؤثر از حقوق موکل، خواهشمند است دستور فرمایید امکان مطالعه پرونده و اخذ کپی و رونوشت از اوراق پرونده، از جمله (مشخص کردن مدارک خاص در صورت نیاز، مانند دادخواست، لوایح، صورت جلسات، گزارش کارشناسی و غیره)، برای اینجانب فراهم گردد.\r\nپیشاپیش از حسن توجه و مساعدت حضرتعالی کمال تشکر را دارم.\r\nبا احترام\r\n(نام وکیل)\r\nوکیل خواهان/ خوانده / شاکی / متهم\r\nتاریخ: …\r\nامضاء: …";
                break;

            case "درخواست اجرای حکم":
                BillContent = "ریاست محترم شعبه اجرای احکام مدنی شهرستان {نام شهرستان}\r\nبا سلام و احترام  \r\nاحتراماً به استحضار می‌رساند اینجانب، به وکالت از {نام موکل} در پرونده کلاسه {کلاسه پرونده} موفق به اخذ حکم قطعی به شماره دادنامه {شماره دادنامه} مورخ {تاریخ} از شعبه {شماره شعبه} دادگاه {نوع دادگاه} شده‌ام.\r\nبا عنایت به قطعیت حکم صادره، خواهشمند است دستور اجرای آن را صادر فرمایید.\r\nبا احترام  \r\nوکیل پایه یک دادگستری  \r\n}نام وکیل{  \r\nتاریخ: {تاریخ}\r\n";
                break;

            case "استرداد اعتراض به نظریه کارشناسی":
                BillContent = "بسمه‌تعالی\r\nریاست محترم شعبه ……… دادگاه ………\r\nبا سلام و احترام\r\nاینجانب (نام وکیل) به وکالت از (نام موکل) در پرونده کلاسه (شماره پرونده)، موضوع (موضوع پرونده)، در خصوص اعتراض به نظریه کارشناسی که پیش‌تر تقدیم دادگاه محترم گردیده، به استحضار می‌رساند:\r\nبا توجه به بررسی‌های مجدد صورت گرفته و در راستای احترام به نظر کارشناسی ارائه‌شده، بدین‌وسیله اعتراض خود را مسترد نموده و آمادگی موکل را جهت اجرای مفاد نظریه کارشناسی اعلام می‌دارم.\r\nلذا از دادگاه محترم تقاضا دارم با توجه به استرداد اعتراض، ادامه رسیدگی را بر اساس نظریه کارشناسی ارائه‌شده انجام داده و تصمیم مقتضی را صادر فرماید.\r\nبا احترام\r\nنام وکیل\r\nامضاء و مهر";
                break;

            case "استرداد دادخواست":
                BillContent = "بسمه تعالی\r\nریاست محترم شعبه … دادگاه عمومی حقوقی …\r\nبا سلام و احترام\r\nاینجانب (نام وکیل)، وکیل پایه یک دادگستری و به وکالت از (نام موکل)، در پرونده شماره (شماره پرونده)، با موضوع (موضوع دعوا) که در آن مرجع محترم مطرح گردیده است، به استحضار می‌رساند:\r\nبا توجه به )دلایل استرداد دادخواست مانند: حصول توافق با طرف دعوی، رفع اختلاف، تغییر استراتژی حقوقی، نقص مدارک و نیاز به تکمیل، یا هر دلیل دیگر(، و مستند به ماده ۱۰۷ قانون آیین دادرسی مدنی، تقاضای استرداد دادخواست تقدیمی را قبل از صدور حکم از آن مقام محترم دارم.\r\nپیشاپیش از حسن نظر و مساعدت حضرتعالی سپاسگزارم.\r\nبا احترام\r\n(نام وکیل)\r\nوکیل پایه یک دادگستری\r\nتاریخ: …\r\nامضاء: …";
                break;

            case "اسقاط حق تجدیدنظرخواهی یا فرجام‌خواهی":
                BillContent = "بسمه‌تعالی\r\nریاست محترم شعبه ……… دادگاه ………\r\nبا سلام و احترام\r\nاینجانب (نام وکیل) به وکالت از (نام موکل) در پرونده کلاسه (شماره پرونده)، موضوع (عنوان پرونده)، بدین‌وسیله اعلام می‌دارم که موکل اینجانب با علم و آگاهی کامل از حقوق قانونی خود، حق تجدیدنظرخواهی / فرجام‌خواهی نسبت به رأی صادره در این پرونده را اسقاط نموده و هیچ‌گونه ادعایی در این خصوص نخواهد داشت.\r\n۱. موکل پس از بررسی رأی صادره، آن را عادلانه و منطبق با قانون تشخیص داده و نیازی به اعتراض یا تجدیدنظر در آن نمی‌بیند.\r\n۲. این تصمیم با اختیار و اراده کامل اتخاذ شده و هیچ‌گونه اجبار یا اکراهی در آن وجود ندارد.\r\n۳. درخواست ثبت اسقاط حق تجدیدنظرخواهی / فرجام‌خواهی و قطعیت رأی صادره مطابق  قانون آیین دادرسی مدنی تقدیم می‌گردد.\r\nبا عنایت به موارد فوق، از دادگاه محترم تقاضا دارم مراتب اسقاط حق تجدیدنظرخواهی / فرجام‌خواهی را در پرونده ثبت نموده و اقدامات مقتضی را در خصوص اجرای رأی صادره مبذول فرمایید.\r\nبا احترام\r\nنام وکیل\r\nامضاء و مهر";
                break;

            case "اعتراض به بهای خواسته":
                BillContent = "بسمه‌تعالی\r\nریاست محترم شعبه ……… دادگاه ………\r\nبا سلام و احترام\r\nاینجانب (نام وکیل) به وکالت از (نام موکل) در پرونده کلاسه (شماره پرونده)، موضوع (عنوان دعوی)، بدین‌وسیله اعتراض خود را نسبت به بهای خواسته تعیین‌شده توسط خواهان اعلام می‌دارم.\r\n۱. مغایرت بهای خواسته با ارزش واقعی مورد دعوی: خواهان در دادخواست تقدیمی، بهای خواسته را مبلغ )مبلغ اعلام‌شده( تعیین نموده که این مبلغ با ارزش واقعی موضوع دعوا تطابق ندارد.\r\n۲. تأثیر نادرست بهای خواسته بر هزینه دادرسی و صلاحیت دادگاه: تعیین نادرست بهای خواسته می‌تواند موجب تغییر در میزان هزینه دادرسی و حتی مرجع صالح رسیدگی گردد که این امر برخلاف موازین قانونی است.\r\n۳. لزوم ارجاع به کارشناس رسمی دادگستری: جهت تعیین دقیق ارزش واقعی موضوع دعوی، پیشنهاد می‌شود که موضوع به کارشناسی ارجاع شود تا از تضییع حقوق موکل جلوگیری گردد.\r\nبا عنایت به موارد فوق، از دادگاه محترم تقاضا دارم:\r\n۱. نسبت به اصلاح بهای خواسته بر اساس ارزیابی دقیق و واقعی اقدام گردد.\r\n۲. در صورت لزوم، موضوع به کارشناس رسمی دادگستری ارجاع شود.\r\n۳. هزینه دادرسی متناسب با بهای واقعی خواسته تعیین گردد.\r\nنام وکیل\r\nامضاء و مهر";
                break;

            case "اظهار به تقدیم دادخواست جلب ثالث":
                BillContent = "بسمه‌تعالی\r\nریاست محترم شعبه ……… دادگاه ………\r\nبا سلام و احترام\r\nاینجانب (نام وکیل) به وکالت از (نام موکل) در پرونده کلاسه (شماره پرونده)، موضوع (عنوان پرونده)، بدین‌وسیله مراتب تقدیم دادخواست جلب ثالث را به استحضار دادگاه محترم می‌رسانم.\r\nنظر به اینکه در جریان رسیدگی به پرونده حاضر، شخص (نام شخص ثالث) به عنوان فردی که حقوق یا تعهدات وی در نتیجه رأی صادره تحت تأثیر قرار می‌گیرد، در موضوع اختلاف نقش دارد، موکل اینجانب به موجب (مواد ۱۳۵ و ۱۳۷ قانون آیین دادرسی مدنی) دادخواست جلب ثالث را بنا به دلایل زیر تنظیم و به دفتر دادگاه محترم تقدیم نموده است:\r\n۱. نقش مؤثر شخص ثالث در موضوع دعوی و ارتباط مستقیم حقوق یا تعهدات وی با نتیجه پرونده.\r\n۲. پیشگیری از تضییع حقوق موکل و جلوگیری از صدور رأیی که بدون لحاظ شدن حقوق شخص ثالث ممکن است ناقص یا ناعادلانه باشد.\r\n۳. تقدیم دادخواست جلب ثالث در مهلت قانونی و درخواست رسیدگی هم‌زمان با پرونده اصلی.\r\nبا توجه به مراتب فوق، از دادگاه محترم تقاضا دارم مراتب تقدیم دادخواست جلب ثالث را در پرونده منعکس نموده و وفق مقررات، اقدامات لازم را جهت رسیدگی هم‌زمان به دعوای اصلی و جلب ثالث به عمل آورید.\r\nبا احترام\r\nنام وکیل\r\nامضاء و مهر";
                break;

            case "لایحه دفاعیه (در دعاوی حقوقی)":
                BillContent = "ریاست محترم شعبه {شماره شعبه} دادگاه محترم {نوع دادگاه} شهرستان {نام شهرستان}\r\nبا سلام و احترام\r\nاینجانب {نام موکل} با وکالت اینجانب در پرونده کلاسه {کلاسه پرونده} به خواسته {خواسته خواهان} بدین‌وسیله لایحه دفاعیه خود را به شرح زیر تقدیم می‌نمایم:\r\n.۱ در خصوص ادعای خواهان مبنی بر {خلاصه خواسته یا ادعا} لازم به ذکر است که...\r\n.۲ با توجه به مستندات پیوست و سوابق موضوع به استحضار می‌رساند...\r\n.۳ از آن مقام محترم تقاضای صدور حکم بر رد دعوای خواهان و احقاق حقوق موکل را دارم.\r\nبا تجدید احترام\r\nوکیل پایه یک دادگستری  \r\n{نام وکیل}  \r\nتاریخ:";
                break;

            case "اعتراض به رأی بدوی":
                BillContent = "ریاست محترم شعبه {شماره شعبه} دادگاه تجدیدنظر استان }نام استان{\r\nموضوع: اعتراض به رأی صادره در پرونده کلاسه }کلاسه پرونده{\r\nبا سلام و احترام  \r\nبدین‌وسیله نسبت به رأی صادره به شماره دادنامه {شماره دادنامه} مورخ {تاریخ صدور رأی} از شعبه }شماره شعبه{ دادگاه بدوی، به وکالت از }نام موکل{، اعتراض می‌نمایم و دلایل اعتراض به شرح زیر تقدیم حضور می‌گردد:\r\n.۱ اولاً،...\r\n.۲ ثانیاً،...\r\nبا توجه به مراتب فوق و مستندات پیوست، از آن مرجع محترم تجدیدنظر تقاضای نقض دادنامه معترضٌ‌عنه و صدور رأی شایسته را دارم.\r\nبا احترام  \r\nوکیل معترض  \r\n{نام وکیل}  \r\nتاریخ: {تاریخ}";
                break;

            case "دفاعیه در دعاوی کیفری":
                BillContent = "ریاست محترم شعبه {شماره شعبه} دادگاه تجدیدنظر استان {نام استان} ریاست محترم شعبه {شماره شعبه} دادگاه کیفری {نوع دادگاه} شهرستان {نام شهرستان}\r\nبا سلام و احترام  \r\nاینجانب، وکیل مدافع آقای/خانم {نام موکل} در پرونده کلاسه {کلاسه پرونده} اتهام وارده مبنی بر {عنوان اتهام} را به دلایل زیر رد می‌نمایم:\r\n.۱ موکل در تاریخ مذکور در محل وقوع جرم حضور نداشته و بر اساس {مدرک/شاهد/...}، بی‌گناهی ایشان محرز است.\r\n.۲ ...\r\nلذا با عنایت به دلایل فوق و مستندات تقدیمی، تقاضای صدور حکم بر برائت موکل را دارم.\r\nبا احترام  \r\nوکیل پایه یک دادگستری  \r\n{نام وکیل}  \r\nتاریخ:";
                break;

            case "درخواست استمهال (تمدید مهلت)":
                BillContent = "ریاست محترم شعبه {شماره شعبه} دادگاه محترم {نوع دادگاه} شهرستان .......\r\nبا سلام و احترام  \r\nاحتراماً در خصوص پرونده کلاسه {کلاسه پرونده} به طرفیت {نام طرف مقابل} به وکالت از {نام موکل}، نظر به شرایط خاص و محدودیت‌های پیش‌آمده، بدین‌وسیله تقاضای استمهال {تمدید مهلت} جهت شرح موضوع، مثلاً: تقدیم لایحه دفاعیه / ارائه اسناد به مدت {مدت مورد نیاز} روز را دارم.\r\nبا تجدید احترام  \r\nوکیل پایه یک دادگستری  \r\nنام وکیل  \r\nتاریخ:";
                break;

            case "معرفی داور":
                BillContent = "بسمه تعالی\r\nریاست محترم شعبه ... دادگاه عمومی حقوقی دادگستري شهرستان...\r\nموضوع : معرفی داور از سوي زوج\r\nسلام علیکم\r\nاحتراماً به استحضار عالی می رساند اینجانب .............. به وکالت از آقاي .................. درخصوص پرونده به شماره بایگانی ..................... مطروحه در شعبه محترم لازم به ذکر است که آقاي ........... فرزند ........... به شماره ملی .................. متاهل که قبولی داوری نیز به پیوست لایحه تقدیم می گردد را به عنوان داور معرفی می نماید.\r\nباتشکر و تجدید احترام";
                break;

            case "✍️ لایحه (سفارشی)":
                BillContent = "لطفاً متن لایحه موردنظر خود را در این قسمت وارد نمایید...";
                break;

            default:
                BillContent = string.Empty;
                break;
        }
    }

    [RelayCommand]
    private async Task ShowContracts()
    {
        SelectedTab = "Contract";
        ResetPanels();
        IsContractsVisible = true;
        ContractContent = ConContent;
        await AnimatePanel("ContractsPanel");
    }

    [RelayCommand]
    private async Task ShowBills()
    {
        SelectedTab = "Bill";
        ResetPanels();
        IsBillsVisible = true;
        await AnimatePanel("BillsPanel");
    }

    private void ResetPanels()
    {
        IsContractsVisible = false;
        IsBillsVisible = false;
        IsWelcomeVisible = false;
    }

    private async Task AnimatePanel(string panelName)
    {
        // اینجا بعداً در CodeBehind می‌تونیم انیمیشن FadeIn/Slide بذاریم
        await Task.Delay(50);
    }

    [RelayCommand]
    private async Task PrintContract()
    {
        string textToPrint = string.Empty;
        string jobName = string.Empty;

        if (IsContractsVisible) // یعنی الان پنل قرارداد فعاله
        {
            if (string.IsNullOrWhiteSpace(ContractContent))
            {
                await Toast.Make("هیچ متنی برای چاپ قرارداد وجود ندارد!", ToastDuration.Short).Show();
                return;
            }

            textToPrint = ContractContent;
            jobName = "قرارداد وکالت";
        }
        else if (IsBillsVisible) // یعنی الان پنل لایحه فعاله
        {
            if (string.IsNullOrWhiteSpace(BillContent))
            {
                await Toast.Make("هیچ متنی برای چاپ لایحه وجود ندارد!", ToastDuration.Short).Show();
                return;
            }

            textToPrint = BillContent;
            jobName = "لایحه حقوقی";
        }
        else
        {
            await Toast.Make("هیچ بخشی برای چاپ انتخاب نشده است!", ToastDuration.Short).Show();
            return;
        }

        if (_printerService != null)
        {
            await _printerService.PrintTextAsync(textToPrint, jobName);
        }
        else
        {
            await Toast.Make("سرویس چاپ پیدا نشد!", ToastDuration.Short).Show();
        }
    }
}